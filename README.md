# План проведения семинаров (21.01.2026)

Дата: 21 января 2026 года (Среда, 3-я учебная неделя)
Общая тема дня: «Реализация подсистемы аутентификации: Формы, Сессии и Хеширование»

---

### ТЕМА: Проектирование БД и создание таблицы `users`
**Цель:** Создать надежный фундамент для системы аутентификации пользователей.
**Инструмент:** Хостинг Beget -> Панель управления MySQL -> phpMyAdmin.

#### ЭТАП 1. Проектирование схемы (Theory)

Перед тем как писать SQL, надо понимать, какие данные мы храним.
**Требования к таблице `users`:**
1.  **Уникальность:** У каждого пользователя должен быть уникальный идентификатор (`id`) и уникальный логин (`email`).
2.  **Безопасность:** Пароли **НИКОГДА** не хранятся в открытом виде. Мы храним только хеш (результат работы функции `password_hash`).
3.  **Ролевая модель:** Нужно различать администратора (может добавлять товары) и клиента (может покупать).
4.  **Аудит:** Полезно знать, когда пользователь зарегистрировался (`created_at`).

---

#### ЭТАП 2. Создание Базы Данных на Beget (Practice)

1.  Зайти в панель управления Beget.
2.  Раздел **MySQL**.
3.  Создать базу данных.
    *   **Имя:** `логин_shop` (например, `one_shop`).
    *   **Пароль:** *Сгенерировать и сохранить в файл `db.php`*.
4.  Нажать кнопку **phpMyAdmin** (иконка `PMA`) напротив созданной базы.

---

#### ЭТАП 3. SQL-код таблицы `users` (Core)

В phpMyAdmin перейти во вкладку **SQL** и выполнить следующий запрос. Этот код является «золотым стандартом» для начала курсовой.

```sql
-- Установка кодировки (на всякий случай)
SET NAMES utf8mb4;

-- Удаляем таблицу, если она была создана неправильно (очистка среды)
DROP TABLE IF EXISTS `users`;

-- Создание таблицы
CREATE TABLE `users` (
  `id` INT(11) NOT NULL AUTO_INCREMENT COMMENT 'Уникальный ID',
  `email` VARCHAR(255) NOT NULL COMMENT 'Логин пользователя',
  `password_hash` VARCHAR(255) NOT NULL COMMENT 'Хеш пароля (НЕ сам пароль!)',
  `username` VARCHAR(100) DEFAULT NULL COMMENT 'Имя для отображения',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT 'Телефон для связи',
  `role` ENUM('admin', 'client') NOT NULL DEFAULT 'client' COMMENT 'Роль доступа',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Дата регистрации',
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `email_unique` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Комментарии:**
*   `VARCHAR(255)` для пароля — обязательно. Хеши алгоритмов (bcrypt, argon2) длинные. Стандартные 32 символа (как для md5) уже **не подходят**.
*   `ENGINE=InnoDB` — поддержка транзакций и внешних ключей (понадобится для заказов в будущем).
*   `utf8mb4` — полная поддержка Unicode (включая эмодзи и редкие символы).

---

#### ЭТАП 4. Наполнение тестовыми данными (Seeding)

Всем нужно создать первого пользователя (Администратора) вручную, чтобы протестировать форму входа (`login.php`), которую они будут писать на второй паре.

**Проблема:** Мы не можем просто написать `INSERT ... VALUES ('admin', '12345')`, так как система входа будет сверять хеши.
**Решение:** Сгенерировать хеш для пароля "admin123".

**SQL-запрос для вставки администратора:**

```sql
-- Пароль: admin123
-- Хеш сгенерирован заранее: $2y$10$Bp.... (пример)
-- Для учебных целей используем фиксированный хеш bcrypt для строки 'admin123'

INSERT INTO `users` (`email`, `password_hash`, `username`, `role`) VALUES
('admin@shop.local', '$2y$10$R.h.y8p.e.g.s.e.c.u.r.e.HASH.EXAMPLE.REPLACE_ME', 'Главный Админ', 'admin'),
('client@shop.local', '$2y$10$R.h.y8p.e.g.s.e.c.u.r.e.HASH.EXAMPLE.REPLACE_ME', 'Тестовый Клиент', 'client');
```

**⚡ Лайфхак для аварийного случая (Как получить реальный хеш прямо сейчас):**
Пусть создадут в корне сайта файл `hash_gen.php`, запустят его один раз и скопируют результат.

```php
<?php
// hash_gen.php
$password = 'admin123';
echo password_hash($password, PASSWORD_DEFAULT);
?>
```
*Полученную строку вставить в SQL запрос выше.*

---

#### ЭТАП 5. Чек-лист проверки (Definition of Done)

Проект готов к написанию PHP-кода, если:
1.  В phpMyAdmin слева видна таблица `users`.
2.  В структуре таблицы поле `id` имеет атрибут `AUTO_INCREMENT` (ключик).
3.  Поле `email` помечено как `UNIQUE` (серебряный ключик) — это предотвратит регистрацию дублей.
4.  В таблице есть хотя бы одна запись, и в поле `password_hash` находится длинная строка (начинается на `$2y$`), а не понятный текст.

### Возможные расширения (для сильных студентов):
Если проект сложный, стоит добавить таблицу `user_profiles` для хранения адреса доставки и привязать её к `users` через `user_id` (связь 1:1), чтобы не перегружать основную таблицу авторизации.

ПАРА 1. ПМ.09 (13:20 – 14:55)

Тема: Обработка данных форм и безопасная регистрация пользователей.

Цель: Реализовать серверный сценарий регистрации нового пользователя с валидацией данных и безопасным сохранением пароля.


    Теоретический блок (15 мин, самостоятельная работа, ответы на вопросы):

        HTTP методы: Разница между GET и POST. Почему для регистрации нельзя использовать GET.

        Валидация данных: "Never trust user input". Проверка на пустоту, формат email (filter_var).

        Безопасность паролей (Критически важно): Почему нельзя хранить пароли в открытом виде. Функции password_hash() (алгоритм bcrypt/argon2) и понятие "соль".

    Практикум «Live Coding» (60 мин):

        Шаг 1. HTML-форма (signup.php): Создание формы с полями email, password, confirm_password. Использование Bootstrap 5 (CDN) для быстрой верстки.

        Шаг 2. Обработчик PHP:

            Прием данных через суперглобальный массив $_POST.

            Проверка: существует ли уже такой email в БД (SQL: SELECT COUNT(*)...).

            Хеширование пароля: $hash = password_hash($pass, PASSWORD_DEFAULT);.

            Запись в БД: INSERT INTO users ... через PDO Prepared Statements (закрепление материала прошлой недели).

    Отладка и тестирование (15 мин):

        Проверка регистрации через браузер.

        Просмотр таблицы users в phpMyAdmin: убедиться, что пароли выглядят как $2y$10$..., а не как «123456».

Код-сэмпл (Регистрация):
code PHP

// register.php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email']);
    $pass = $_POST['password'];
    
    // Валидация
    if (empty($email) || empty($pass)) {
        die("Заполните все поля");
    }

    // Хеширование
    $hash = password_hash($pass, PASSWORD_DEFAULT);

    // Сохранение (предполагаем $pdo подключен из db.php)
    $stmt = $pdo->prepare("INSERT INTO users (email, password_hash) VALUES (?, ?)");
    try {
        $stmt->execute([$email, $hash]);
        echo "Регистрация успешна! <a href='login.php'>Войти</a>";
    } catch (PDOException $e) {
        if ($e->getCode() == 23000) { // Код дубликата unique key
            echo "Такой email уже занят.";
        } else {
            echo "Ошибка БД.";
        }
    }
}

ПАРА 2. МДК.09.01 (15:05 – 16:40)

Тема: Работа с сессиями и механизм авторизации (Login).

Цель: Реализовать вход в систему, управление состоянием пользователя между страницами (сессии) и защиту страниц.
План занятия:

    Теоретический блок (15 мин):

        Stateless протокол HTTP: Почему сервер "забывает" пользователя после каждого запроса.

        Механизм Сессий: session_start(), файл сессии на сервере, Cookie PHPSESSID.

        Аутентификация: Сверка введенного пароля с хешем в БД (password_verify()).

    Практикум «Live Coding» (60 мин):

        Шаг 1. HTML-форма входа (login.php).

        Шаг 2. Логика авторизации:

            Поиск пользователя по email.

            Если найден -> password_verify($input_pass, $db_hash).

            Если пароль верен -> Запись данных в сессию: $_SESSION['user_id'] = $user['id'];.

        Шаг 3. Защита страниц (Access Control):

            Создание файла profile.php, доступного только авторизованным.

            Проверка: if (!isset($_SESSION['user_id'])) { header('Location: login.php'); }.

        Шаг 4. Выход (Logout): Уничтожение сессии (session_destroy()).

    Самостоятельная работа / Курсовой проект (15 мин):

        Пользователи адаптируют код под свои темы курсовых (например, добавляют поле "Имя" или "Телефон" при регистрации).

Код-сэмпл (Авторизация):
code PHP

// login.php
session_start();
require 'db.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = $_POST['email'];
    $pass = $_POST['password'];

    $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->execute([$email]);
    $user = $stmt->fetch();

    if ($user && password_verify($pass, $user['password_hash'])) {
        // Успешный вход
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['role'] = $user['role'];
        header("Location: profile.php"); // Редирект
        exit;
    } else {
        echo "Неверный логин или пароль";
    }
}

Задание для самостоятельной работы (Дома / В конце пар)

В рамках подготовки Курсового проекта (Выбран случайно) все должны к следующей неделе:

    Развернуть созданные скрипты на хостинге Beget.

    Реализовать меню навигации, которое меняется в зависимости от состояния:

        Гость видит: "Главная", "Вход", "Регистрация".

        Пользователь видит: "Главная", "Профиль", "Выход".

        Подсказка: Использовать if (isset($_SESSION['user_id'])) в HTML-шаблоне.

    Инструменты: Все примеры показываем в VS Code, заливаем через FileZilla (или плагин SFTP), проверяем на реальном домене .beget.tech. Локальный OpenServer не используем, чтобы привыкать к продакшн-среде.

